<div class="preview-backdrop" (click)="onBackdropClick($event)">
    <div class="preview-container">
        <!-- Header (Standard Flow) - Only if Title Exists -->
        <header class="preview-header" *ngIf="titleContent">
            <div class="header-content">
                <ng-content select="[preview-title]"></ng-content>
            </div>

            <div class="header-controls" style="display: flex; align-items: center; gap: 0.5rem;">
                <!-- Custom Actions -->
                <div class="header-actions" *ngIf="headerActionsContent">
                    <ng-container *ngTemplateOutlet="headerActionsContent.template"></ng-container>
                </div>

                <div class="divider" *ngIf="headerActionsContent" style="width: 1px; height: 1.5rem; background: #eee;">
                </div>

                <button mat-icon-button class="close-btn" [disabled]="closeLocked" (click)="close.emit()"
                    aria-label="Close preview">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </header>

        <!-- Floating Controls (Overlay) - Only if Title is Missing -->
        <div class="floating-controls" *ngIf="!titleContent">
            <div class="floating-pill" cdkDrag cdkDragBoundary=".preview-container">
                <!-- Drag Handle -->
                <div cdkDragHandle
                    style="cursor: move; color: #999; display: flex; align-items: center; justify-content: center; padding-left: 4px;">
                    <mat-icon style="font-size: 20px; width: 20px; height: 20px;">drag_indicator</mat-icon>
                </div>

                <div class="divider"></div>

                <div class="header-actions" *ngIf="headerActionsContent">
                    <ng-container *ngTemplateOutlet="headerActionsContent.template"></ng-container>
                </div>

                <div class="divider" *ngIf="headerActionsContent"></div>

                <button mat-icon-button [disabled]="closeLocked" (click)="close.emit()" aria-label="Close preview">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="preview-body">
            <!-- Notification/Alert Bar -->
            <div class="preview-alert-bar" *ngIf="alertContent">
                <ng-content select="[preview-alert]"></ng-content>
            </div>

            <!-- Hover Navigation Zones -->
            <div class="nav-zone left" [class.visible]="hasPrevious && !navigationLocked"
                (click)="hasPrevious && !navigationLocked && previous.emit()">
                <div class="zone-indicator">
                    <mat-icon>chevron_left</mat-icon>
                </div>
            </div>

            <div class="nav-zone right" [class.visible]="hasNext && !navigationLocked"
                (click)="hasNext && !navigationLocked && next.emit()">
                <div class="zone-indicator">
                    <mat-icon>chevron_right</mat-icon>
                </div>
            </div>

            <!-- Content -->
            <div class="content-wrapper">
                <div *ngIf="isLoading" class="loading-overlay">
                    <div class="spinner"></div>
                </div>

                <ng-content></ng-content>
            </div>
        </div>

        <!-- Footer Panel -->
        <div class="preview-footer" *ngIf="footerContent">
            <ng-content select="[preview-footer]"></ng-content>
        </div>
    </div>
</div>